<ui:Page x:Class="IslandCaller.Views.Pages.ProfilePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:ui="http://schemas.inkore.net/lib/ui/wpf/modern"
      xmlns:viewmodel="clr-namespace:IslandCaller.ViewModel.Pages"
      xmlns:local="clr-namespace:IslandCaller.Views.Pages" 
      xmlns:converter="clr-namespace:IslandCaller.Converter"
      xmlns:sys="clr-namespace:System;assembly=netstandard"
      mc:Ignorable="d" 
      d:DataContext="{d:DesignInstance Type=viewmodel:ProfilePageViewModel}"
      d:DesignHeight="450" d:DesignWidth="800"
      Title="ProfilePage" >

    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ui:ThemeResources/>
                <ui:XamlControlsResources/>
            </ResourceDictionary.MergedDictionaries>
            <converter:IntToBoolConverter x:Key="IntToBoolConverter" />
            <converter:GuidActionConverter x:Key="GuidActionConverter" />
        </ResourceDictionary>
    </Page.Resources>
    <Page.DataContext>
        <viewmodel:ProfilePageViewModel/>
    </Page.DataContext>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <ui:SettingsCard 
        VerticalAlignment="Top"
        Header="默认名单"
        Description="一般情况下使用的名单"
        Margin="20,10,20,5" Grid.Row="0">
            <ui:SettingsCard.HeaderIcon>
                <ui:FontIcon Icon="{x:Static ui:SegoeFluentIcons.DocumentApproval}"/>
            </ui:SettingsCard.HeaderIcon>
            <ComboBox 
                x:Name="DefaultCombo"
                ui:ControlHelper.PlaceholderText="选择默认名单"
                ItemsSource="{Binding ProfileList, Mode=TwoWay}"
                DisplayMemberPath="Value"
                SelectedValuePath="Key"
                SelectedValue="{Binding DefaultProfileName}">
            </ComboBox>
        </ui:SettingsCard>
        <ui:SettingsExpander 
            VerticalAlignment="Top"
            Header="名单管理"
            Description="管理所有名单"
            Margin="20,0,20,5" Grid.Row="1">
            <ui:SettingsExpander.HeaderIcon>
                <ui:FontIcon Icon="{x:Static ui:SegoeFluentIcons.Document}"/>
            </ui:SettingsExpander.HeaderIcon>
            <Button x:Name="AddButton"
                    Content="添加名单(敬请期待)"
                    Click="AddButton_Click" 
                    Visibility="{Binding IsExpanded, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ui:SettingsExpander}}}"
                    IsEnabled="False"/>
            <ui:SettingsExpander.Items>
                <DataGrid ItemsSource="{Binding ProfileList}"
                    AutoGenerateColumns="False"
                    HeadersVisibility="None"
                    CanUserAddRows="False"
                    CanUserDeleteRows="False"
                    IsReadOnly="True"
                    IsHitTestVisible="True"
                    Focusable="False" 
                    CanUserResizeRows="False"
                    SelectionUnit="Cell"
                    HorizontalGridLinesBrush="Transparent"
                    SelectionMode="Single">
                    <DataGrid.Resources>
                        <Style TargetType="DataGridCell" BasedOn="{x:Null}">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderBrush" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Padding" Value="4,2"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="DataGridCell">
                                        <Grid Background="{TemplateBinding Background}">
                                            <ContentPresenter VerticalAlignment="Center"
                                              HorizontalAlignment="Left"/>
                                        </Grid>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <!-- 选中无变化 -->
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="{Binding Foreground, RelativeSource={RelativeSource Self}}"/>
                                </Trigger>
                                <!-- 悬停无变化 -->
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="Transparent"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                        <!-- DataGridRow 样式 -->
                        <Style TargetType="DataGridRow" BasedOn="{x:Null}">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderBrush" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="DataGridRow">
                                        <Border Background="{TemplateBinding Background}">
                                            <DataGridCellsPresenter/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <!-- 选中无变化 -->
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="{Binding Foreground, RelativeSource={RelativeSource Self}}"/>
                                </Trigger>
                                <!-- 悬停无变化 -->
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="Transparent"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>

                    </DataGrid.Resources>
                    <DataGrid.Columns>
                        <!-- 显示 Dictionary 的 Key -->
                        <DataGridTextColumn Binding="{Binding Value}" Width="2*" FontSize="14">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Left"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="TextAlignment" Value="Center"/>
                                    <Setter Property="Margin" Value="5,5,5,5"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- 第一个按钮 -->
                        <DataGridTemplateColumn Width="Auto">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button 
                                        Content="编辑"
                                        Tag="{Binding Key}"
                                        Margin="4"
                                        Click="EditButton_Click"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>

                        </DataGridTemplateColumn>

                        <!-- 第二个按钮 -->
                        <DataGridTemplateColumn Width="Auto">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button
                                        Content="删除"
                                        Tag="{Binding Key}"
                                        Margin="4"
                                        Click="DeleteButton_Click"
                                        Foreground="White"
                                        Background="Red"
                                        IsEnabled="False"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </ui:SettingsExpander.Items>
        </ui:SettingsExpander>
        <ui:SettingsCard 
            VerticalAlignment="Top"
            Header="走班模式(敬请期待)"
            Description="适配走班制教学：在不同科目上使用不同名单"
            Margin="20,0,20,5" Grid.Row="2"
            IsClickEnabled="True"
            IsEnabled="False">
            <ui:SettingsCard.HeaderIcon>
                <ui:FontIcon Icon="{x:Static ui:SegoeFluentIcons.People}"/>
            </ui:SettingsCard.HeaderIcon>
            <ui:ToggleSwitch
                IsOn="{Binding IsPreferProfile}"
                IsEnabled="{Binding PreferProfileNum, Converter={StaticResource IntToBoolConverter}}"/>
        </ui:SettingsCard>
    </Grid>
</ui:Page>
